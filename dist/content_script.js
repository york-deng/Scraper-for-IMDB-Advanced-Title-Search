var _ping_='ping';var _pong_='pong';var _entry_='entry';var _ready_='ready';var _start_='start';var _progress_='progress';var _continue_='continue';var _detail_='detail';var _finish_='finish';var _next_result_='nextResult';var _next_detail_='nextDetail';var _retrieve_='retrieve';var _download_='download';var prefix='advance.title.search.detail.url.';var urlsKey='advance.title.search.detail.urls';var urlBase='https://www.imdb.com';var urlEntry='https://www.imdb.com/search/title/';var urlResult='https://www.imdb.com/search/title/?';var keySearch='/search';var perPage=(50);var urlDetail='https://www.imdb.com/title/';var urlImages=['*://*.media-amazon.com/images*','*://*.zergnet.com/*'];var urlSelector='div.lister-item-content > h3 > a';var keyExpr=(new RegExp('tt[0-9]+'));var titleSelector='div.title_wrapper > h1';var genreSelector='#titleStoryLine a[href^="/search/title?genres"]';var ratingSelector='div.imdbRating > div.ratingValue > strong > span';var countriesSelector='#titleDetails a[href^="/search/title?country_of_origin"]';var storylineSelector='#titleStoryLine > div:nth-child(3) > p > span';var statusSelector='.status-message-heading';var date=(new Date()).getTime();var example=[{id:'tt0068646',title:'The Godfather',genre:35,rating:'bill@company.com',countries:'',status:'',storyline:'',url1:'https://www.imdb.com/title/tt0068646/',url2:'',start:date,index:0,}];var url=document.URL;var idb=null;if(idb==null&&(url.startsWith(urlBase)||typeof(url)=='undefined'||url==null)){var idbVersion=18;var idbRequest=indexedDB.open('IMDBAdvanceTitleSearch',idbVersion);idbRequest.onupgradeneeded=function(d){var e=d.target.result;var f=e.createObjectStore('works',{keyPath:'id'});f.createIndex('title','title',{unique:false});f.createIndex('start','start',{unique:false});f.transaction.oncomplete=function(b){var c=e.transaction("works","readwrite").objectStore("works");example.forEach(function(a){})}};idbRequest.onsuccess=function(a){idb=a.target.result};idbRequest.onerror=function(a){alert("Why didn't you allow this app to use IndexedDB?!")}};function notifyAll(a,b,c,d,e){var f=localStorage.getItem(urlsKey);var g=f==null?0:f;if(typeof(e)==='undefined'||e==null){alert('Error: typeof(index) === \'undefined\' || index == null')}else if(e>g){var h=_finish_;var i='';if(i==null){}else{chrome.extension.sendMessage({action:h,startTime:a,totalResult:b,currentStep:d,totalStep:d,index:e,url:i})}}else{var h=_detail_;var j=prefix+e;var i=localStorage.getItem(j);if(i==null){alert('Error: value == null (key = '+j+')')}else{chrome.extension.sendMessage({action:h,startTime:a,totalResult:b,currentStep:c,totalStep:d,index:e,url:i})}}};function extract(b,c,d,e,f){var g=new Date();var h=document.URL;var i='';var j='';var k=keyExpr.exec(h)[0];var l=document.querySelectorAll(titleSelector);var m='';if(l){try{m=l[0].innerText}catch(error){console.log(error)}};var n=document.querySelectorAll(genreSelector);var o='';if(n){n.forEach(function(a){if(o!=''){o+=', '};try{o+=a.innerText}catch(error){console.log(error)}})};var p=document.querySelectorAll(ratingSelector);var q='';if(p){try{q=p[0].innerText}catch(error){console.log(error)}};var r=document.querySelectorAll(countriesSelector);var s='';if(r){r.forEach(function(a){if(s!=''){s+=', '};try{s+=a.innerText}catch(error){console.log(error)}})};var t=document.querySelectorAll(storylineSelector);var u='';if(t){try{u=t[0].innerText}catch(error){console.log(error)}};var v=document.querySelectorAll(statusSelector);var w='';if(v){try{w=v[0].innerText}catch(error){console.log(error)}};var x={id:k,title:m,genre:o,rating:q,countries:s,status:w,storyline:u,url1:h,url2:i,start:b,index:f};if(idb){try{var y=idb.transaction("works","readwrite").objectStore("works");var z=y.add(x);return z}catch(error){alert(error)}};return(null)};chrome.extension.onMessage.addListener(function(h,j,k){if(h.action==_next_result_){var l=h.startTime;var m=h.totalResult;var n=h.currentPage;var o=h.totalPage;var p=h.currentStep;var q=h.totalStep;if(l==0){localStorage.clear()};var r=localStorage.getItem(urlsKey);var s=r==null?0:r;var t=null;if(n<=o){t=document.querySelectorAll(urlSelector);for(var i=0;i<t.length;i++){var u=s++;var v=prefix+u;var w=t[i].href;localStorage.setItem(v,w)};localStorage.setItem(urlsKey,s)};q=s>(o*perPage)?o+s:o+(o*perPage);if(l==0){var x=_ready_;chrome.extension.sendMessage({action:x,startTime:l,totalResult:m,currentPage:n,totalPage:o,currentStep:p,totalStep:q})}else if(typeof(t)!='undefined'&&t!=null&&t.length>0&&n<o){var x=_continue_;chrome.extension.sendMessage({action:x,startTime:l,totalResult:m,currentPage:n,totalPage:o,currentStep:p,totalStep:q})}else{var x=_detail_;var v=prefix+0;var w=localStorage.getItem(v);if(w==null){alert('Error: value == null (key = '+v+')')}else{chrome.extension.sendMessage({action:x,startTime:l,totalResult:m,currentStep:p,totalStep:q,index:0,url:w})}}}else if(h.action==_next_detail_){var l=h.startTime;var m=h.totalResult;var p=h.currentStep;var q=h.totalStep;var u=h.index;var y=extract(l,m,p,q,u);var r=localStorage.getItem(urlsKey);var s=r==null?0:r;if(typeof(u)==='undefined'||u==null){alert('Error: typeof(index) === \'undefined\' || index == null')}else if(u>=s){var x=_finish_;var w='';if(w==null){}else{chrome.extension.sendMessage({action:x,startTime:l,totalResult:m,currentStep:q,totalStep:q,index:u,url:w})}}else{var v=prefix+u;var w=localStorage.getItem(v);if(w==null){alert('Error: value == null (key = '+v+')')}else{var x=_detail_;chrome.extension.sendMessage({action:x,startTime:l,totalResult:m,currentStep:p,totalStep:q,index:u,url:w})}}}else if(h.action==_retrieve_){if(idb){var z=h.latest;var A=idb.transaction('works','readwrite').objectStore('works');var B=A.index('start');var C=0;B.openCursor().onsuccess=function(d){var e=d.target.result;if(e){var f=e.key;C=C>f?C:f;e.continue()}else{var g=z?B.getAll(C):B.getAll();g.onsuccess=function(){var a=g.result;var b=JSON.stringify(a);var c=_download_;if(b==null){alert('Error: list == null (start = '+C+', latest = '+z+')')}else{chrome.extension.sendMessage({action:c,list:b})}};g.onerror=function(a){alert("Why didn't you allow my web app to use IndexedDB?!")}}}}}});